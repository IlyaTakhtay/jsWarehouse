var M=Object.defineProperty;var H=(i,e,t)=>e in i?M(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(H(i,typeof e!="symbol"?e+"":e,t),t),q=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var d=(i,e,t)=>(q(i,e,"read from private field"),t?t.call(i):e.get(i)),p=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},m=(i,e,t,o)=>(q(i,e,"write to private field"),o?o.call(i,t):e.set(i,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var E,I,C,D;class T{constructor({amount:e,position:t,productInCargo:o,onDeleteCargo:r}){p(this,E,"");p(this,I,"");p(this,C,"");p(this,D,-1);l(this,"cargo__text");m(this,E,crypto.randomUUID()),m(this,I,e),m(this,D,t),m(this,C,o),this.onDeleteCargo=r}get cargoID(){return d(this,E)}get cargoAmount(){return d(this,I)}set cargoAmount(e){typeof e=="string"&&m(this,I,e)}get productInCargo(){return d(this,C)}set productInCargo(e){typeof e=="string"&&m(this,C,e)}get cargoPosition(){return d(this,D)}set cargoPosition(e){typeof e=="number"&&e>=0&&m(this,D,e)}render(){const e=document.createElement("li");e.classList.add("orderlist__cargo-list-item","cargo"),e.setAttribute("id",d(this,E)),e.setAttribute("draggable",!0),e.addEventListener("dragstart",a=>{a.target.classList.add("cargo_selected"),localStorage.setItem("movedCargoID",d(this,E))}),e.addEventListener("dragend",a=>a.target.classList.remove("cargo_selected"));const t=document.createElement("span");t.classList.add("cargo__text"),t.innerHTML=d(this,I),e.appendChild(t);const o=document.createElement("span");o.classList.add("cargo__number"),o.innerHTML=d(this,C),e.appendChild(o);const r=document.createElement("div");r.classList.add("cargo__controls");const s=document.createElement("select");s.classList.add("cargo__select"),s.addEventListener("change",a=>{this.selectedOption=a.target.value});const n=document.createElement("div");n.classList.add("cargo__controls-row");const c=document.createElement("button");c.setAttribute("type","button"),c.classList.add("cargo__contol-btn","edit-icon"),c.addEventListener("click",()=>{document.getElementById("app-edit-modal").showModal(),localStorage.setItem("editCargoID",d(this,E))}),n.appendChild(c);const h=document.createElement("button");return h.setAttribute("type","button"),h.classList.add("cargo__contol-btn","delete-icon"),h.addEventListener("click",()=>this.onDeleteCargo({cargoID:d(this,E)})),n.appendChild(h),r.appendChild(n),e.appendChild(r),e}}E=new WeakMap,I=new WeakMap,C=new WeakMap,D=new WeakMap;var g,L,u,A;const _=class _{constructor({name:e,position:t,onDropCargoInOrderlist:o,onDeleteCargo:r}){p(this,g,[]);p(this,L,"");p(this,u,"");p(this,A,-1);l(this,"addCargo",({cargo:e})=>d(this,g).push(e));l(this,"getCargoByID",({cargoID:e})=>d(this,g).find(t=>t.cargoID===e));l(this,"findCargoByName",({productInCargo:e})=>d(this,g).find(t=>t.productInCargo===e));l(this,"deleteCargo",({cargoID:e})=>{const t=d(this,g).findIndex(r=>r.cargoID===e);if(t===-1)return;const[o]=d(this,g).splice(t,1);return o});l(this,"deleteOrderlist",()=>{document.getElementById(d(this,u)).remove(),this.decrementCounter(),console.log("del")});l(this,"reorderCargos",()=>{console.log(document.querySelector(`[id="${d(this,u)}"] .orderlist__cargo-list`)),Array.from(document.querySelector(`[id="${d(this,u)}"] .orderlist__cargo-list`).children,t=>t.getAttribute("id")).forEach((t,o)=>{d(this,g).find(r=>r.cargoID===t).cargoPosition=o}),console.log(d(this,g))});l(this,"onEditOrderlist",()=>{const e=document.getElementById(d(this,u));var t=Array.from(e.querySelectorAll(".orderlist-adder__input"));t.forEach(o=>{o.hasAttribute("readOnly")?o.readOnly=!1:o.readOnly=!0})});l(this,"appendNewCargo",({productInCargo:e,amount:t})=>{const o=d(this,g).find(r=>r.productInCargo===e);if(o)o.cargoAmount=String(Number(o.cargoAmount)+Number(t)),document.querySelector(`[id="${o.cargoID}"] span.cargo__text`).innerHTML=d(this,g)[o.cargoPosition].cargoAmount,console.log(d(this,g));else{const r=new T({amount:t,productInCargo:e,position:d(this,g).length,selectedOption:this.selectedOption,onDeleteCargo:this.onDeleteCargo});d(this,g).push(r);const s=r.render();document.querySelector(`[id="${d(this,u)}"] .orderlist__cargo-list`).appendChild(s)}});l(this,"renderDeleteButton",()=>{const e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("cargo__contol-btn","delete-icon"),e.addEventListener("click",this.deleteOrderlist),e});l(this,"editOrderlistName",()=>{const e=prompt("Введите новое название списка задач:",d(this,L));e!==null&&(m(this,L,e),document.getElementById(d(this,u)).querySelector(".orderlist__name").innerHTML=e)});m(this,L,e),m(this,u,crypto.randomUUID()),m(this,A,t),this.onDropCargoInOrderlist=o,this.onDeleteCargo=r,this.order=_.counter++}get orderlistID(){return d(this,u)}decrementCounter(){_.counter=Math.max(1,_.counter-1)}render(){console.log("↑");const e=document.createElement("li");e.classList.add("order-list__item","orderlist"),e.setAttribute("id",d(this,u)),e.addEventListener("dragstart",()=>localStorage.setItem("srcOrderlistID",d(this,u))),e.addEventListener("drop",this.onDropCargoInOrderlist),e.appendChild(this.renderDeleteButton());const t=document.createElement("h1"),o=document.createElement("span");o.classList.add("orderlist-heading__order");const r=document.createElement("span");r.classList.add("orderlist-heading__order-id"),t.appendChild(o),t.appendChild(r),t.classList.add("orderlist-heading"),o.innerHTML="Заказ ",r.innerHTML=`${d(this,u)}`,e.appendChild(t);const s=new Date,n=s.getFullYear(),c=(s.getMonth()+1).toString().padStart(2,"0"),h=s.getDate().toString().padStart(2,"0"),a=`${n}-${c}-${h}`,y=document.createElement("input");y.type="text",y.classList.add("orderlist-adder__input"),y.placeholder="Имя заказчика",e.appendChild(y);const b=document.createElement("input");b.type="date",b.classList.add("orderlist-adder__input"),b.style="margin-bottom: 20px",b.min=a,e.appendChild(b);const S=document.createElement("button");S.setAttribute("type","button"),S.classList.add("orderlist__edit-orderlist-btn"),S.innerHTML="&#10010; Редактировать поля ввода",S.addEventListener("click",this.onEditOrderlist),e.appendChild(S);const B=document.createElement("ul");B.classList.add("orderlist__cargo-list"),e.appendChild(B);const v=document.createElement("button");v.setAttribute("type","button"),v.classList.add("orderlist__add-cargo-btn"),v.innerHTML="&#10010; Добавить карточку",v.addEventListener("click",()=>{document.getElementById("app-add-modal").showModal(),localStorage.setItem("addOrderlistID",d(this,u))}),e.appendChild(v);const N=document.querySelector(".orderlist-adder");N.parentElement.insertBefore(e,N)}};g=new WeakMap,L=new WeakMap,u=new WeakMap,A=new WeakMap,l(_,"counter",1);let O=_;var f;class k{constructor(){p(this,f,[]);l(this,"onDropCargoInOrderlist",e=>{e.stopPropagation();const t=e.currentTarget;t.classList.remove("orderlist_droppable");const o=localStorage.getItem("movedCargoID"),r=localStorage.getItem("srcOrderlistID"),s=t.getAttribute("id");if(localStorage.setItem("movedCargoID",""),localStorage.setItem("srcOrderlistID",""),!t.querySelector(`[id="${o}"]`))return;const n=d(this,f).find(a=>a.orderlistID===r),c=d(this,f).find(a=>a.orderlistID===s);if(r!==s){const a=n.deleteCargo({cargoID:o});c.addCargo({cargo:a}),n.reorderCargos()}Array.from(t.querySelector(".orderlist__cargo-list").children,a=>a.getAttribute("id")).forEach((a,y)=>{c.getCargoByID({cargoID:a}).cargoPosition=y})});l(this,"EditCargo",({cargoID:e,newProductInCargo:t,newCargoAmount:o})=>{let r=null,s=null;for(let a of d(this,f))if(s=a,r=a.getCargoByID({cargoID:e}),r)break;const n=s.findCargoByName({productInCargo:t});if(n&&n.cargoID!=e){alert("Такой товар уже есть"),console.log("YEST PROBITIE",n.cargoID);return}const c=r.cargoAmount,h=r.productInCargo;(!o||o===c)&&(!t||t===h)||(r.cargoAmount=o,r.productInCargo=t,document.querySelector(`[id="${e}"] span.cargo__text`).innerHTML=o,document.querySelector(`[id="${e}"] span.cargo__number`).innerHTML=t)});l(this,"onDeleteCargo",({cargoID:e})=>{let t=null,o=null;for(let r of d(this,f))if(o=r,t=r.getCargoByID({cargoID:e}),t)break;o.deleteCargo({cargoID:e}),document.getElementById(e).remove()});l(this,"cargoNameAddSelectorAppend",()=>{const e=document.getElementById("cargoName-Add"),t=document.createElement("option");t.text="HrenSgory",e.add(t)});l(this,"cargoNameEditSelectorAppend",()=>{const e=document.getElementById("cargoName-Edit"),t=document.createElement("option");t.text="HrenSgory",e.add(t)});l(this,"initAddModal",()=>{const e=document.getElementById("app-add-modal");console.log(e),this.cargoNameAddSelectorAppend();const t=()=>{e.close(),localStorage.setItem("addOrderlistID","")},o=()=>{const r=localStorage.getItem("addOrderlistID"),s=document.getElementById("cargoName-Add").value,n=document.getElementById("cargoCount-Add").value;console.log("crgID",r),console.log("crgName",s),console.log("crgCount",n),r&&n&&n&&(console.log(s),d(this,f).find(c=>c.orderlistID===r).appendNewCargo({productInCargo:s,amount:n}),t())};e.querySelector(".dialog-ok__btn").addEventListener("click",o),e.querySelector(".dialog-close__btn").addEventListener("click",t)});l(this,"initEditModal",()=>{const e=document.getElementById("app-edit-modal");console.log("no",e),this.cargoNameEditSelectorAppend();const t=()=>{e.close(),localStorage.setItem("editCargoID","")},o=()=>{const r=localStorage.getItem("editCargoID"),s=document.getElementById("cargoName-Edit").value,n=document.getElementById("cargoCount-Edit").value;console.log("1",r),console.log("2",s),console.log("3",n),r&&n&&n&&(console.log("Nezshel"),this.EditCargo({cargoID:r,newCargoAmount:n,newProductInCargo:s}),t())};e.querySelector(".dialog-ok__btn").addEventListener("click",o),e.querySelector(".dialog-close__btn").addEventListener("click",t)})}init(){document.querySelector(".orderlist-adder__btn").addEventListener("click",e=>{const t=new O({name:e.target.value,onDropCargoInOrderlist:this.onDropCargoInOrderlist,onDeleteCargo:this.onDeleteCargo});d(this,f).push(t),t.render(),document.querySelectorAll(".orderlist-adder__input").forEach(o=>{o.style.display="inherit"})}),this.initAddModal(),this.initEditModal(),document.getElementById("theme-switch").addEventListener("change",e=>{e.target.checked?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}),document.addEventListener("dragover",e=>{e.preventDefault();const t=document.querySelector(".cargo.cargo_selected");if(t===null)return;const o=t.closest(".orderlist"),r=e.target,s=document.querySelector(".orderlist_droppable");let n=e.target;for(;!n.matches(".orderlist")&&n!==document.body;)n=n.parentElement;if(n!==s&&(s&&s.classList.remove("orderlist_droppable"),n.matches(".orderlist")&&n.classList.add("orderlist_droppable")),!(!n.matches(".orderlist")||t===r)){if(n===o){if(!r.matches(".cargo"))return;const c=r===t.nextElementSibling?r.nextElementSibling:r;n.querySelector(".orderlist__cargo-list").insertBefore(t,c);return}if(r.matches(".cargo")){n.querySelector(".orderlist__cargo-list").insertBefore(t,r);return}n.querySelector(".orderlist__cargo-list").children.length||n.querySelector(".orderlist__cargo-list").appendChild(t)}})}}f=new WeakMap;document.addEventListener("DOMContentLoaded",()=>{new k().init()});
