var j=Object.defineProperty;var T=(i,e,t)=>e in i?j(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>(T(i,typeof e!="symbol"?e+"":e,t),t),B=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var a=(i,e,t)=>(B(i,e,"read from private field"),t?t.call(i):e.get(i)),C=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},m=(i,e,t,o)=>(B(i,e,"write to private field"),o?o.call(i,t):e.set(i,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class f{static async getListOfProducts(){try{const e=await fetch("http://localhost:8001/products"),t=await e.json();return e.status!=200?Promise.reject(t):t.porductsList}catch(e){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:e.message})}}static async getOrderlists(){try{const e=await fetch("http://localhost:8001/orderlists"),t=await e.json();return e.status!=200?Promise.reject(t):t.orderlists}catch(e){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:e.message})}}static async addOrderlist({orderID:e,position:t=-1}={orderID:null,position:-1}){try{const o=await fetch("http://localhost:8001/orderlists",{method:"POST",body:JSON.stringify({orderID:e,position:t}),headers:{"Content-Type":"application/json"}});if(o.status!=200){const r=await o.json();return Promise.reject(r)}return{timestamp:new Date().toISOString(),message:`Orderlist успешно добавлен! ${e}`}}catch(o){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:o.message})}}static async updateOrderlist({orderID:e,name:t,orderDate:o,position:r=-1}={orderID:null,name:"",orderDate:"",position:-1}){try{const n=await fetch("http://localhost:8001/orderlists",{method:"PATCH",body:JSON.stringify({orderID:e,name:t,orderDate:o,position:r}),headers:{"Content-Type":"application/json"}});if(n.status!=200){const s=await n.json();return Promise.reject(s)}return{timestamp:new Date().toISOString(),message:`Orderlist успешно обновлен! ${e}`}}catch(n){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:n.message})}}static async addCargo({cargoID:e,cargoName:t,cargoCount:o,orderID:r,position:n=-1}={cargoID:null,cargoName:"",cargoCount:"",orderID:null,position:-1}){try{const s=await fetch("http://localhost:8001/cargos",{method:"POST",body:JSON.stringify({cargoID:e,cargoName:t,cargoCount:o,orderID:r,position:n}),headers:{"Content-Type":"application/json"}});if(s.status!=200){const l=await s.json();return Promise.reject(l)}return{timestamp:new Date().toISOString(),message:`Cargo успешно добавлен! ${e} в ${r}`}}catch(s){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:s.message})}}static async updateCargo({cargoID:e,cargoName:t,cargoCount:o,orderID:r,position:n}={cargoID:null,cargoName:"",cargoCount:"",orderID:null,position:-1}){try{const s=await fetch(`http://localhost:8001/cargos/${e}`,{method:"PATCH",body:JSON.stringify({cargoName:t,cargoCount:o,orderID:r,position:n}),headers:{"Content-Type":"application/json"}});if(s.status!=200){const l=await s.json();return Promise.reject(l)}return{timestamp:new Date().toISOString(),message:`Параметры Cargo ${e} успешно обновлены в ${r}`}}catch(s){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:s.message})}}static async moveCargo({cargoID:e,srcOrderID:t,destOrderID:o}={cargoID:null,srcOrderID:null,destOrderID:null}){try{const r=await fetch("http://localhost:8001/cargos",{method:"PATCH",body:JSON.stringify({cargoID:e,srcOrderID:t,destOrderID:o}),headers:{"Content-Type":"application/json"}});if(r.status!=200){const n=await r.json();return Promise.reject(n)}return{timestamp:new Date().toISOString(),message:`Cargo ${e} успешно перенесен из ${t} в ${o}`}}catch(r){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:r.message})}}static async deleteCargo({cargoID:e}={cargoID:null}){try{const t=await fetch(`http://localhost:8001/cargos/${e}`,{method:"DELETE"});if(t.status!=200){const o=await t.json();return Promise.reject(o)}return{timestamp:new Date().toISOString(),message:`Cargo ${e} успешно удален`}}catch(t){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:t.message})}}static async deleteOrderlist({orderID:e}={orderID:null}){try{const t=await fetch(`http://localhost:8001/orderlists/${e}`,{method:"DELETE"});if(t.status!=200){const o=await t.json();return Promise.reject(o)}return{timestamp:new Date().toISOString(),message:`Список ${e} и все Cargos успешно удалены`}}catch(t){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:t.message})}}static async updateWarehouse({productName:e,productAmount:t}={productName:"",productAmount:-1}){try{const o=await fetch("http://localhost:8001/warehouse",{method:"PATCH",body:JSON.stringify({productName:e,productAmount:t}),headers:{"Content-Type":"application/json"}});if(o.status!=200){const r=await o.json();return Promise.reject(r)}return{timestamp:new Date().toISOString(),message:"Параметры Warehouse успешно обновлены"}}catch(o){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:o.message})}}}var D,O,S,E;class q{constructor({cargoID:e=null,amount:t,position:o,productInCargo:r,onDeleteCargo:n}){C(this,D,"");C(this,O,"");C(this,S,"");C(this,E,-1);d(this,"cargo__text");m(this,D,e||crypto.randomUUID()),m(this,O,t),m(this,E,o),m(this,S,r),this.onDeleteCargo=n}get cargoID(){return a(this,D)}get cargoAmount(){return a(this,O)}set cargoAmount(e){typeof e=="string"&&m(this,O,e)}get productInCargo(){return a(this,S)}set productInCargo(e){typeof e=="string"&&m(this,S,e)}get cargoPosition(){return a(this,E)}set cargoPosition(e){typeof e=="number"&&e>=0&&m(this,E,e)}render(){const e=document.createElement("li");e.classList.add("orderlist__cargo-list-item","cargo"),e.setAttribute("id",a(this,D)),e.setAttribute("draggable",!0),e.addEventListener("dragstart",u=>{u.target.classList.add("cargo_selected"),localStorage.setItem("movedCargoID",a(this,D))}),e.addEventListener("dragend",u=>u.target.classList.remove("cargo_selected"));const t=document.createElement("span");t.classList.add("cargo__text"),t.innerHTML=a(this,O),e.appendChild(t);const o=document.createElement("span");o.classList.add("cargo__number"),o.innerHTML=a(this,S),e.appendChild(o);const r=document.createElement("div");r.classList.add("cargo__controls");const n=document.createElement("select");n.classList.add("cargo__select"),n.addEventListener("change",u=>{this.selectedOption=u.target.value});const s=document.createElement("div");s.classList.add("cargo__controls-row");const l=document.createElement("button");l.setAttribute("type","button"),l.classList.add("cargo__contol-btn","edit-icon"),l.addEventListener("click",()=>{document.getElementById("app-edit-modal").showModal(),localStorage.setItem("editCargoID",a(this,D))}),s.appendChild(l);const g=document.createElement("button");return g.setAttribute("type","button"),g.classList.add("cargo__contol-btn","delete-icon"),g.addEventListener("click",()=>this.onDeleteCargo({cargoID:a(this,D)})),s.appendChild(g),r.appendChild(s),e.appendChild(r),e}}D=new WeakMap,O=new WeakMap,S=new WeakMap,E=new WeakMap;var p,y,c,I,_;class P{constructor({orderlistID:e=null,name:t,date:o,position:r,onDropCargoInOrderlist:n,onDeleteCargo:s}){C(this,p,[]);C(this,y,"");C(this,c,null);C(this,I,"");C(this,_,-1);d(this,"pushCargo",({cargo:e})=>a(this,p).push(e));d(this,"getCargoByID",({cargoID:e})=>a(this,p).find(t=>t.cargoID===e));d(this,"findCargoByName",({productInCargo:e})=>a(this,p).find(t=>t.productInCargo===e));d(this,"deleteCargo",({cargoID:e})=>{const t=a(this,p).findIndex(r=>r.cargoID===e);if(t===-1)return;const[o]=a(this,p).splice(t,1);return o});d(this,"deleteOrderlist",async()=>{try{const t=await f.deleteOrderlist({orderID:a(this,c)});console.log(t)}catch(t){console.error(t)}document.getElementById(a(this,c)).remove(),console.log("del")});d(this,"reorderCargos",()=>{console.log(document.querySelector(`[id="${a(this,c)}"] .orderlist__cargo-list`)),Array.from(document.querySelector(`[id="${a(this,c)}"] .orderlist__cargo-list`).children,t=>t.getAttribute("id")).forEach((t,o)=>{a(this,p).find(r=>r.cargoID===t).cargoPosition=o}),console.log(a(this,p))});d(this,"onEditOrderlist",async()=>{const e=document.getElementById(a(this,c));var t=Array.from(e.querySelectorAll(".orderlist-adder__input")),o=!1;if(t.forEach(r=>{r.value&&(r.type=="text"&&a(this,y)!=r.value&&(m(this,y,r.value),console.log("Новый текст",a(this,y)),o=!0),r.type=="date"&&a(this,I)!=r.value&&(m(this,I,r.value),console.log("Новый новая дата",a(this,I)),o=!0),r.hasAttribute("readOnly")?r.readOnly=!1:r.readOnly=!0)}),o)try{console.log(a(this,y));const r=await f.updateOrderlist({orderID:a(this,c),name:a(this,y),orderDate:a(this,I),position:a(this,_)});console.log(r)}catch(r){console.error(r)}});d(this,"appendNewCargo",async({productInCargo:e,amount:t})=>{const o=a(this,p).find(r=>r.productInCargo===e);if(o){o.cargoAmount=String(Number(o.cargoAmount)+Number(t)),document.querySelector(`[id="${o.cargoID}"] span.cargo__text`).innerHTML=a(this,p)[o.cargoPosition].cargoAmount;try{console.log("yep2",o),console.log("yep2",o.productInCargo);const r=await f.updateCargo({cargoID:o.cargoID,cargoCount:Number(o.cargoAmount)});console.log(r)}catch(r){console.error(r)}}else try{const r=crypto.randomUUID(),n=await f.addCargo({cargoID:r,cargoName:e,cargoCount:t,orderID:a(this,c),position:a(this,p).length});this.addNewCargoLocal({cargoID:r,amount:t,productInCargo:e,position:a(this,p).length}),console.log(n)}catch(r){console.error(r)}});d(this,"addNewCargoLocal",({cargoID:e=null,amount:t,productInCargo:o,position:r})=>{const n=new q({cargoID:e,amount:t,productInCargo:o,position:r,selectedOption:this.selectedOption,onDeleteCargo:this.onDeleteCargo});a(this,p).push(n);const s=n.render();document.querySelector(`[id="${a(this,c)}"] .orderlist__cargo-list`).appendChild(s)});d(this,"renderDeleteButton",()=>{const e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("cargo__contol-btn","delete-icon"),e.addEventListener("click",this.deleteOrderlist),e});d(this,"editOrderlistName",()=>{const e=prompt("Введите новое название списка задач:",a(this,y));e!==null&&(m(this,y,e),document.getElementById(a(this,c)).querySelector(".orderlist__name").innerHTML=e)});m(this,y,t),m(this,I,o),m(this,c,e||crypto.randomUUID()),m(this,_,r),this.onDropCargoInOrderlist=n,this.onDeleteCargo=s}get orderlistID(){return a(this,c)}get orderlistName(){return a(this,y)}get orderlistDate(){return a(this,I)}get orderlistPosition(){return a(this,_)}render(){console.log("↑");const e=document.createElement("li");e.classList.add("order-list__item","orderlist"),e.setAttribute("id",a(this,c)),e.addEventListener("dragstart",()=>localStorage.setItem("srcOrderlistID",a(this,c))),e.addEventListener("drop",this.onDropCargoInOrderlist),e.appendChild(this.renderDeleteButton());const t=document.createElement("h1"),o=document.createElement("span");o.classList.add("orderlist-heading__order");const r=document.createElement("span");r.classList.add("orderlist-heading__order-id"),t.appendChild(o),t.appendChild(r),t.classList.add("orderlist-heading"),o.innerHTML="Заказ ",r.innerHTML=`${a(this,c)}`,e.appendChild(t);const n=new Date,s=n.getFullYear(),l=(n.getMonth()+1).toString().padStart(2,"0"),g=n.getDate().toString().padStart(2,"0"),u=`${s}-${l}-${g}`,v=document.createElement("input");v.type="text",v.classList.add("orderlist-adder__input"),v.placeholder="Имя заказчика",e.appendChild(v);const L=document.createElement("input");L.type="date",L.classList.add("orderlist-adder__input"),L.style="margin-bottom: 20px",L.min=u,e.appendChild(L);const w=document.createElement("button");w.setAttribute("type","button"),w.classList.add("orderlist__edit-orderlist-btn"),w.innerHTML="&#10010; Редактировать поля ввода",w.addEventListener("click",this.onEditOrderlist),e.appendChild(w);const A=document.createElement("ul");A.classList.add("orderlist__cargo-list"),e.appendChild(A);const b=document.createElement("button");b.setAttribute("type","button"),b.classList.add("orderlist__add-cargo-btn"),b.innerHTML="&#10010; Добавить карточку",b.addEventListener("click",()=>{document.getElementById("app-add-modal").showModal(),localStorage.setItem("addOrderlistID",a(this,c))}),e.appendChild(b);const N=document.querySelector(".orderlist-adder");N.parentElement.insertBefore(e,N)}}p=new WeakMap,y=new WeakMap,c=new WeakMap,I=new WeakMap,_=new WeakMap;var h;class ${constructor(){C(this,h,[]);d(this,"onDropCargoInOrderlist",async e=>{e.stopPropagation();const t=e.currentTarget;t.classList.remove("orderlist_droppable");const o=localStorage.getItem("movedCargoID"),r=localStorage.getItem("srcOrderlistID"),n=t.getAttribute("id");if(localStorage.setItem("movedCargoID",""),localStorage.setItem("srcOrderlistID",""),!t.querySelector(`[id="${o}"]`))return;const s=a(this,h).find(g=>g.orderlistID===r),l=a(this,h).find(g=>g.orderlistID===n);try{if(r!==n){const g=await f.moveCargo({cargoID:o,srcOrderID:r,destOrderID:n}),u=s.deleteCargo({cargoID:o});l.pushCargo({cargo:u}),s.reorderCargos(),console.log(g)}l.reorderCargos()}catch(g){console.error(g)}});d(this,"editCargo",async({cargoID:e,newProductInCargo:t,newCargoAmount:o})=>{let r=null,n=null;for(let u of a(this,h))if(n=u,r=u.getCargoByID({cargoID:e}),r)break;const s=n.findCargoByName({productInCargo:t});if(s&&s.cargoID!=e){alert("Такой товар уже есть"),console.log("YEST PROBITIE",s.cargoID);return}const l=r.cargoAmount,g=r.productInCargo;if(!((!o||o===l)&&(!t||t===g)))try{const u=await f.updateCargo({cargoID:e,cargoName:t,cargoCount:o});r.cargoAmount=o,r.productInCargo=t,document.querySelector(`[id="${e}"] span.cargo__text`).innerHTML=o,document.querySelector(`[id="${e}"] span.cargo__number`).innerHTML=t,console.log(u)}catch(u){console.error(u)}});d(this,"onDeleteCargo",async({cargoID:e})=>{let t=null,o=null;for(let r of a(this,h))if(o=r,t=r.getCargoByID({cargoID:e}),t)break;try{const r=await f.deleteCargo({cargoID:e});o.deleteCargo({cargoID:e}),document.getElementById(e).remove(),console.log(r)}catch(r){console.error(r)}});d(this,"addEmptyOrderlist",async()=>{const e=crypto.randomUUID();try{const t=await f.addOrderlist({orderID:e,position:a(this,h).length}),o=new P({orderlistID:e,position:a(this,h).length,onDropCargoInOrderlist:this.onDropCargoInOrderlist,onDeleteCargo:this.onDeleteCargo});a(this,h).push(o),o.render(),console.log(t)}catch(t){console.error(t)}document.querySelectorAll(".orderlist-adder__input").forEach(t=>{t.style.display="inherit"})});d(this,"cargoNameSelectorAppender",async({selector:t})=>{console.log("get inside Add");var t;t=="ADD"&&(t=document.getElementById("cargoName-Add")),t=="EDIT"&&(t=document.getElementById("cargoName-Edit"));try{const o=await f.getListOfProducts();console.log(o),o.forEach(r=>{console.log(r);const n=document.createElement("option");n.text=r,t.add(n)}),console.log(o)}catch(o){console.error(o)}});d(this,"initAddModal",()=>{const e=document.getElementById("app-add-modal");console.log(e),this.cargoNameSelectorAppender({selector:"ADD"});const t=()=>{e.close(),localStorage.setItem("addOrderlistID","")},o=()=>{const r=localStorage.getItem("addOrderlistID"),n=document.getElementById("cargoName-Add").value,s=document.getElementById("cargoCount-Add").value;console.log("crgID",r),console.log("crgName",n),console.log("crgCount",s),r&&s&&s&&(console.log(n),a(this,h).find(l=>l.orderlistID===r).appendNewCargo({productInCargo:n,amount:s}),t())};e.querySelector(".dialog-ok__btn").addEventListener("click",o),e.querySelector(".dialog-close__btn").addEventListener("click",t)});d(this,"initEditModal",()=>{const e=document.getElementById("app-edit-modal");console.log("no",e),this.cargoNameSelectorAppender({selector:"EDIT"});const t=()=>{e.close(),localStorage.setItem("editCargoID","")},o=()=>{const r=localStorage.getItem("editCargoID"),n=document.getElementById("cargoName-Edit").value,s=document.getElementById("cargoCount-Edit").value;console.log("1",r),console.log("2",n),console.log("3",s),r&&s&&s&&(console.log("Nezshel"),this.editCargo({cargoID:r,newCargoAmount:s,newProductInCargo:n}),t())};e.querySelector(".dialog-ok__btn").addEventListener("click",o),e.querySelector(".dialog-close__btn").addEventListener("click",t)});d(this,"scrubAllOrderlists",async()=>{console.log(a(this,h)),a(this,h).forEach(e=>{console.log(e)});try{const e=await f.updateWarehouse({productName:"Мемы",productAmount:10});console.log(e)}catch(e){console.error(e)}console.log("workbtn")})}async init(){document.querySelector(".orderlist-adder__btn").addEventListener("click",this.addEmptyOrderlist),document.querySelector(".floating__btn").addEventListener("click",this.scrubAllOrderlists),this.initAddModal(),this.initEditModal(),document.getElementById("theme-switch").addEventListener("change",e=>{e.target.checked?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}),document.addEventListener("dragover",e=>{e.preventDefault();const t=document.querySelector(".cargo.cargo_selected");if(t===null)return;const o=t.closest(".orderlist"),r=e.target,n=document.querySelector(".orderlist_droppable");let s=e.target;for(;!s.matches(".orderlist")&&s!==document.body;)s=s.parentElement;if(s!==n&&(n&&n.classList.remove("orderlist_droppable"),s.matches(".orderlist")&&s.classList.add("orderlist_droppable")),!(!s.matches(".orderlist")||t===r)){if(s===o){if(!r.matches(".cargo"))return;const l=r===t.nextElementSibling?r.nextElementSibling:r;s.querySelector(".orderlist__cargo-list").insertBefore(t,l);return}if(r.matches(".cargo")){s.querySelector(".orderlist__cargo-list").insertBefore(t,r);return}s.querySelector(".orderlist__cargo-list").children.length||s.querySelector(".orderlist__cargo-list").appendChild(t)}});try{const e=await f.getOrderlists();console.log(e);for(const t of e){const o=new P({orderlistID:t.orderlistID,name:t.orderlistName,date:t.orderlistDate,position:t.orderlistPosition,onDropCargoInOrderlist:this.onDropCargoInOrderlist,onDeleteCargo:this.onDeleteCargo});a(this,h).push(o),console.log("massive",a(this,h)),o.render();const r=document.getElementById(t.orderlistID);Array.from(r.querySelectorAll(".orderlist-adder__input")).forEach(s=>{s.type=="date"&&(s.value=t.orderlistDate,console.log("orderlistname",t.orderlistDate),console.log(s.value),s.value!=""&&(s.readOnly=!0)),s.type=="text"&&(console.log("orderlistname",t.orderlistName),s.value=t.orderlistName,s.value!=""&&(s.readOnly=!0))}),document.querySelectorAll(".orderlist-adder__input").forEach(s=>{s.style.display="inherit"});for(const s of t.cargos)o.addNewCargoLocal({cargoID:s.cargoID,amount:s.cargoAmount,productInCargo:s.productInCargo,position:s.cargoPosition})}}catch(e){console.error(e)}}}h=new WeakMap;document.addEventListener("DOMContentLoaded",()=>{new $().init()});
